<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Web Applications with PicoContainer</title>
</head>

<body>
<p>This page follows on from the PicoContainer <a href="http://picocontainer.org/scopes.html">scopes</a> page</p>
<h2>Web Containers / Web Frameworks</h2>
<p>There are only about a million Java web-frameworks for Java. There
more recent and sophisticated ones try to do Dependency Injection for
'actions' or 'controllers'. </p>
<p>If you want to use PicoContainer for a web framework, then you're
likely to end up with three container levels. The root container would
be common to all and known as the <strong>application scoped</strong> container. Next is a <strong>session-scoped</strong> one, with the app one marked as its parent. Lastly a <strong>request scoped</strong>
one, with the session one marked as its parent. There are two
not-so-subtle variations on how they would be used. One, we pioneered
with PicoContainer 1.x in 2003, the other introduced with PicoContainer
2.x in 2007.</p>
<h3>PicoContainer and web frameworks - the old way.</h3>
<p>You make one instance of the app container. For each new HTTP
Session you make a new session level container, and put it into the
session itself - refer HttpSession.setAttribute(key,val). For each
request, you make a new Request level container and discard it at the
end of the request. For as long as it lives, the request level
container's parent would be the session container.</p>
<p>There are two downsides of this approach. 1) you have to repeatedly
add components to the session and request containers as they are
instantiated. 2) the serialization of the session (by Tomcat etc) might
cause more things to be serialized than you intend - i.e. the session
container refers to the application container.</p>
<h3>PicoContainer and web frameworks - the new way.</h3>
<p>We make one instance of the app, session and request containers as
the web app loads. For the Application one, Caching is set.
For the session and request level ones, we store instantiated components 
for those scopes in ThreadLocal. For the session container, the same components 
are stored in the HttpSession as an attribute).</p>
<p>Here is a view of web.xml</p>
<div class="source">
  <pre><!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd" >
<web-app>

  <context-param>
    <param-name>webapp-composer-class</param-name>
    <param-value>org.picocontainer.web.sample.ExampleWebappComposer</param-value>
  </context-param>

  <filter>
    <filter-name>picoFilter</filter-name>
    <filter-class>org.picocontainer.web.PicoServletContainerFilter</filter-class>
  </filter>

  <filter-mapping>
    <filter-name>picoFilter</filter-name>
    <url-pattern>/*</url-pattern>
  </filter-mapping>

  <listener>
    <listener-class>org.picocontainer.web.PicoServletContainerListener</listener-class>
  </listener>

</web-app>
</pre>
</div>
<p>The above is not complete.  It is just the core of PicoContainer web enablement. Refer to the left-nav for bindings to existing web-frameworks like Struts2 etc</p>
</body>
</html>