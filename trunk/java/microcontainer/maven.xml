<project  xmlns:j="jelly:core" xmlns:u="jelly:util" >

    <preGoal name="test:test" >
        <echo>Building test.mca file for use with unit tests </echo>
        <attainGoal name="build-test.mca"/>
        
    </preGoal>
    
    <goal name="build-test.mca" >
        <attainGoal name="compile-testcomp"/>
        <attainGoal name="test-promoted.jar"/>
        <attainGoal name="test-components.jar"/>
        <attainGoal name="test-hidden.jar"/>
        <delete file="test.mca"/>
        <zip destfile="test.mca">
            <fileset dir="src/testcomp/" includes="*.groovy"/>
            <zipfileset dir="target/classes/" includes="promoted.jar" prefix="MCA-INF/promoted"/>
            <zipfileset dir="target/classes/" includes="components.jar" prefix="MCA-INF/components"/>
            <zipfileset dir="target/classes/" includes="hidden.jar" prefix="MCA-INF/hidden"/>
        </zip>
    </goal>

    <goal name="test-promoted.jar">
        <delete file="target/classes/promoted.jar"/>
          <jar destfile="target/classes/promoted.jar"
              basedir="src/testcomp/target/classes"
              includes="org/microcontainer/testapi/TestPromotable.class"/>
      </goal>

    <goal name="test-components.jar">
        <delete file="target/classes/components.jar"/>
          <jar destfile="target/classes/components.jar"
              basedir="src/testcomp/target/classes"
              includes="org/microcontainer/test/TestComp.class"/>
      </goal>

    <goal name="test-hidden.jar">
        <delete file="target/classes/hidden.jar"/>
          <jar destfile="target/classes/hidden.jar"
              basedir="src/testcomp/target/classes"
              includes="org/microcontainer/test/hopefullyhidden/*.class"/>
      </goal>

    <goal name="compile-testcomp">
        <mkdir dir="src/testcomp/target/classes"/>
        <javac srcdir="src/testcomp"
             destdir="src/testcomp/target/classes"
             includes="**/*"
             debug="on">
            <classpath refid="maven.dependency.classpath"/>
        </javac>
    </goal>


        <goal name="jar">
            <attainGoal name="test"/>

        <delete file="target/microcontainer-api-0.1-SNAPSHOT.jar"/>
          <jar destfile="target/microcontainer-api-0.1-SNAPSHOT.jar"
              basedir="target/classes"
              includes="org/microcontainer/*.class"/>
        <delete file="target/microcontainer-impl-0.1-SNAPSHOT.jar"/>
          <jar destfile="target/microcontainer-impl-0.1-SNAPSHOT.jar"
              basedir="target/classes"
              includes="org/microcontainer/impl/**.class"/>

      </goal>

      <goal name="microcontainerzip" >
        <attainGoal name="jar"/>
        <delete file="target/microcontainer.zip"/>
        <zip destfile="target/microcontainer.zip">
          <fileset dir="src/bootstrap" includes="*.groovy"/>
          <fileset dir="src/bootstrap" includes="*.bat"/>
          <zipfileset dir="target" includes="*api*.jar" prefix="lib"/>
          <zipfileset dir="target" includes="*impl*.jar" prefix="lib/hidden"/>
          <zipfileset dir="../picocontainer/target" includes="picocontainer-1.1-SNAPSHOT.jar" prefix="lib"/>
          <zipfileset dir="../nanocontainer/target" includes="nanocontainer-1.0-SNAPSHOT.jar" prefix="lib"/>
        </zip>
      </goal>

    
</project>


