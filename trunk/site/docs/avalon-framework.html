<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Making components compatible with Avalon-Framework</title>
</head>
<body>
<h2>Overview</h2>
Apache's Avalon's component specification is enshrined in a number of
interfaces. What this means is that the component writer has to
implement them to designate their class as an Avalon component.&nbsp;
PicoComponents require adaptation to fit the type-1 Avalon-Framework
design.<br>
<br>
This document details how to do this manually.<br>
<h2>A simple example component<br>
</h2>
<h3>Example component APIs</h3>
<div style="margin-left: 40px;">public interface Engine {<br>
&nbsp; void runEngine();<br>
}<br>
public interface Persistor {<br>
&nbsp; void persist(String key, Object data);<br>
}<br>
</div>
<br>
<h3><span style="font-weight: bold;">A simple Pico implementation of
the
hypothetical engine.</span></h3>
<br>
<pre style="margin-left: 40px;">public class EngineImpl implements Engine {<br>&nbsp; Persistor persistor;<br>&nbsp; String persistenceKey;<br>&nbsp; Object persistable;<br>&nbsp; public void EngineImpl(Persistor persistor, String persistenceKey) {<br>&nbsp;&nbsp;&nbsp; this.persistor = persistor;<br>&nbsp;&nbsp;&nbsp; this.persistorKey = persistorKey;<br>&nbsp;&nbsp;&nbsp; persistable = new Object(); // not very 'heavy' we appreciate.<br>&nbsp; }<br>&nbsp; public void runEngine() {<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; persistor.persist(persistorKey, persistable);<br>&nbsp; }<br>}<br></pre>
<h3>The same component natively written for Apache Avalon</h3>
<pre style="margin-left: 40px;">public class AvalonEngine implements Engine, Servicable, Configurable, Initializable {<br>&nbsp; Persistor persistor;<br>&nbsp; String persistenceKey;<br>&nbsp; Object persistable;<br>&nbsp; public void service (ServiceManager sm) throws ServiceException {<br>&nbsp;&nbsp;&nbsp; this.persistor = (Persistor) sm.lookup("Persistor");<br>&nbsp; }<br>&nbsp; public void configure(Configuration conf) {<br>&nbsp;&nbsp;&nbsp; this.persistorKey = conf.getAttribute("persistorKey");<br>&nbsp; }<br>&nbsp; public void initialize() {<br>&nbsp;&nbsp;&nbsp; persistable = new Object(); // not very 'heavy' we appreciate.<br>&nbsp; }<br>&nbsp; public void runEngine() {<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; persistor.persist(persistorKey, persistable);<br>&nbsp; }<br>}<br></pre>
<h3><span style="font-weight: bold;">An alternate wrapping strategy for
Apache Avalon compatability.</span></h3>
<pre style="margin-left: 40px;">public class AvalonEngine implements Engine, Servicable, Configurable, Initializable {<br>&nbsp; private Engine engine;<br>&nbsp; // temporary<br>&nbsp; private Persistor persistor;<br>&nbsp; private String persistenceKey;<br>&nbsp; public void service (ServiceManager sm) throws ServiceException {<br>&nbsp;&nbsp;&nbsp; this.persistor = (Persistor) sm.lookup("Persistor");<br>&nbsp; }<br>&nbsp; public void configure(Configuration conf) {<br>&nbsp;&nbsp;&nbsp; this.persistorKey = conf.getAttribute("persistorKey");<br>&nbsp; }<br>&nbsp; public void initialize() {<br>&nbsp;&nbsp;&nbsp; engine = new EngineImpl(persistor persistenceKey);<br>&nbsp; }<br>&nbsp; public void runEngine() {<br>&nbsp; {<br>&nbsp;&nbsp;&nbsp; engine.runEngine();<br>&nbsp; }<br>}<br></pre>
<br>
<small>Authors: Paul Hammant</small><br>
</body>
</html>
